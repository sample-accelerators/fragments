accelerator:
  options:
    - name: packageName
      inputType: text
      defaultValue: "com.example.customerprofile"
      label: Application root package
      required: true

engine:
  merge:
    - type: Include
      patterns: [ "**/profile.html", "**/application-local.yml" ]

    - include: [ "**/OidcUserController.java", "**/WebSecurityConfiguration.java" ]
      chain:
        - type: OpenRewriteRecipe
          recipe: org.openrewrite.java.ChangePackage
          options:
            oldPackageName: "'com.vmware.tap.fragments.appssoauthcodeflow'"
            newPackageName: "#packageName"

    - include: [ "pom.xml" ]
      chain:
        - type: ReplaceText
          substitutions:
            - text: "<dependencies>"
              with: |
                '<dependencies>
                        <dependency>
                            <groupId>org.thymeleaf.extras</groupId>
                            <artifactId>thymeleaf-extras-springsecurity5</artifactId>
                        </dependency>
                '
        - type: ReplaceText
          substitutions:
            - text: "<dependencies>"
              with: |
                '<dependencies>
                        <dependency>
                            <groupId>org.springframework.boot</groupId>
                            <artifactId>spring-boot-starter-thymeleaf</artifactId>
                        </dependency>'
        - type: ReplaceText
          substitutions:
            - text: "<dependencies>"
              with: |
                '<dependencies>
                        <!-- AppSSO/OIDC Integration -->
                        <dependency>
                            <groupId>org.springframework.boot</groupId>
                            <artifactId>spring-boot-starter-oauth2-client</artifactId>
                        </dependency>'

    - include: [ "build.gradle.kts" ]
      chain:
        - type: ReplaceText
          substitutions:
            - text: "dependencies {"
              with: "'dependencies {\n    implementation(\"org.springframework.boot:spring-boot-starter-oauth2-client\")'"
        - type: ReplaceText
          substitutions:
            - text: "dependencies {"
              with: "'dependencies {\n    implementation(\"org.springframework.boot:spring-boot-starter-thymeleaf\")'"
        - type: ReplaceText
          substitutions:
            - text: "dependencies {"
              with: "'dependencies {\n    implementation(\"org.thymeleaf.extras:thymeleaf-extras-springsecurity5\")'"
